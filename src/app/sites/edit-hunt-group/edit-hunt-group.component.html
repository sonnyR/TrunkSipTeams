<div class="modal-header">
    <h5 class="modal-title">Modifier hunt group</h5>
    <button type="button" (click)="close()" class="close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="registerHuntGroupForm" (ngSubmit)="onUpdateHuntGroup()" *ngIf="registerHuntGroupForm">
      <div class="col-md-12" style="margin: 15px 0 15px 0; padding: 0; ">
        <div id="accordionEmplacement" class="accordion">
          <div class="card">
            <div class="card-header">
              <span class="Title">
                <i class="glyphicon glyphicon-hdd"></i>
                Paramètres généraux

              </span>
            </div>
            <div id="collapseEmplacement" class="collapse show" data-parent="#accordionEmplacement">
              <div class="card-body">
                <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                  <div class="col-lg-12">
                    <span class="input-group-addon">
                        Groupe de recherche Nom (*) <br/>
                        Le nom est utilisé pour l’ID de l’appelant par défaut et pour référencer le groupe de distribution des appels plus tard dans le processus.
                    </span>
                    <div class="form-line">
                      <input type="text" [ngClass]="{'is-invalid': submitted && f['tb_Name'].errors }"
                       formControlName="tb_Name" class="form-control">
                      <div *ngIf="submitted && f['tb_Name'].errors" class="invalid-feedback">
                        <div *ngIf="f['tb_Name'].errors['required']">
                          Il faut saisir le nom de hunt group.
                        </div>
                      </div>
                    </div>
                  </div>
             
            </div>
          
    
      <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
          <div class="col-lg-6">
            <span class="input-group-addon">
              Prénom (*)
      
            </span>
            <div class="form-line">
             
                  <input type="text" [ngClass]="{'is-invalid': submitted && f['tb_FirstName'].errors }" class="form-control" formControlName="tb_FirstName">
                  <div *ngIf="submitted && f['tb_FirstName'].errors" class="invalid-feedback">
                      <div *ngIf="f['tb_FirstName'].errors['required']">
                          Le prénom de l’ID d’appelant de hunt groupdoit être renseignés.
                      </div>
                    </div>
              <!--c'est un champ obligatroire le nombre doit etre entre 0 et 250 -->
              
              
            </div>
          </div>
          <div class="col-lg-6">
              <span class="input-group-addon">
                Nom (*)
        
              </span>
              <div class="form-line">
               
                    <input type="text" [ngClass]="{'is-invalid': submitted && f['tb_LastName'].errors }" class="form-control" formControlName="tb_LastName">
                    <div *ngIf="submitted && f['tb_LastName'].errors" class="invalid-feedback">
                        <div *ngIf="f['tb_LastName'].errors['required']">
                          Le nom de l’ID d’appelant de hunt group doit être renseignés.
                        </div>
                      </div>
                
                
              </div>
            </div>
      
      </div>
      <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
        <div class="col-lg-6">
          <span class="input-group-addon">
            Activer le hunt group
          </span>
          <div class="form-check form-switch">
             <input style="cursor: pointer;" class="form-check-input" type="checkbox" formControlName="tb_enableHuntGroup" id="checkPhone">
            <!--<label class="form-check-label" for="checkPhone">Activer le hunt group</label> -->
          </div>
        </div>
    
    
    </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-12">
        <div id="accordionEmplacement" class="accordion">
          <div class="card">
            <div class="card-header">
              <span class="Title">
                <i class="glyphicon glyphicon-hdd"></i>
                Numéro de téléphone

              </span>
            </div>
            <div id="collapseEmplacement" class="collapse show" data-parent="#accordionEmplacement">
              <div class="card-body">
              
                <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                    <div class="col-md-5" style="padding-bottom:0;">
                        <div class="input-group-tous">
                          <span class="input-group-addon">
                              Numéro de téléphone
                          </span>
                          <div class="form-line">
                              <ng-select 
                              formControlName="tb_PhoneNumber" [searchFn]="startsWithSearchFn" (change)="setExtensionOblige($event)">
                              <ng-option value="">Aucun</ng-option>
                              <ng-option *ngFor="let num of numbersPhone"
                                [value]="num['phoneNumber']">{{num['phoneNumber']}}</ng-option>
                            </ng-select> 
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2" style="padding-bottom:0;">
                          <div class="input-group-tous">
                            <span class="input-group-addon">
                               
                            </span>
                            <div class="form-line">
                              <span>et/ou</span>
                             
                            </div>
                          
                          </div>
                        </div>
                      <div class="col-md-5" style="padding-bottom:0;">
                        <div class="input-group-tous">
                          <span class="input-group-addon">
                             Extension <span *ngIf="obligatoireExtension">(*)</span>
                          </span>
                          <div class="form-line">
                            <input formControlName="tb_extension" [ngClass]="{'is-invalid': submitted && f['tb_extension'].errors }"
                              class="form-control" type="text"   (keypress)="extensionControl($event)" placeholder="Saisissez un numéro de deux à six chiffres">
                              <div *ngIf="submitted && f['tb_extension'].errors" class="invalid-feedback">
                                <div *ngIf="f['tb_extension'].errors['minlength']">La longueur ne peut pas être inférieure à 2
                                </div>
                                <div *ngIf="f['tb_extension'].errors['maxlength']">La longueur ne peut pas être supérieure à 6
                                </div>
                                <div *ngIf="f['tb_extension'].errors['pattern']">Doit saisir des chiffres
                                </div>
                                <div *ngIf="f['tb_extension'].errors['required']">
                                  Il faut saisir l'extension car le champ <b>numéro de téléphone</b>  est vide
                                </div>
                              </div>
                            </div>
                        </div>
                      </div>
               
              </div>
              <!-- <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                <div class="col-md-5" style="padding-bottom:0;">
                    <div class="input-group-tous">
                      <span class="input-group-addon">
                        Autres numéros<br/>
                        Ajoutez d'autres numéros en utilisant le champ de recherche.
                        Il y a une limite maximum de 10 numéros.
                      </span>
                      <div class="form-line">
                          <ng-select 
                          formControlName="tb_AnotherPhoneNumber" [searchFn]="startsWithSearchFn" (change)="selectAnotherPhoneNumber($event)">
                          <ng-option value="">Aucun</ng-option>
                          <ng-option *ngFor="let num of AnotherNumberPhone"
                            [value]="num['phoneNumber']">{{num['phoneNumber']}}</ng-option>
                        </ng-select> 
                      </div>
                    </div>
                  </div>
                
             
           
          </div> -->
            
              </div>
            </div>
          </div>
        </div>
      </div> 
      <div class="col-md-12">
        <div id="accordionEmplacement" class="accordion">
          <div class="card">
            <div class="card-header">
              <span class="Title">
                <i class="glyphicon glyphicon-hdd"></i>
                Schéma de routage des appels
              </span>
            </div>
            <div id="collapseEmplacement" class="collapse show" data-parent="#accordionEmplacement">
              <div class="card-body">
              
                <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                  <div class="col-lg-12">
                    <span class="input-group-addon">
                        Sélectionnez le modèle de routage des appels <br/>
                        Le schéma de routage des appels détermine combien de téléphones sonnent lorsqu’un appel arrive sur votre groupe de distribution des
                        appels, ainsi que l’ordre de sonnerie de ces téléphones.              
                    </span>
                 
                  </div>
                 
              
              </div>
              <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                <div class="col-lg-12">
                
                  <div class="form-line">
                   
                    
                    <div class="form-check">
                      <input class="form-check-input" style="cursor: pointer;" id="circulaire" type="radio" value="CIRCULAR" formControlName="tb_policy" (click)="pendrePolicy($event)">
                      <label class="form-check-label" for="circulaire">Circulaire (Maximum 1 000 agents)<br/>Envoyer les appels à l’agent disponible suivant, en passant par tous les agents après le dernier qui a répondu à un appel.
                       
                        </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" style="cursor: pointer;" type="radio" id="hautEnBas"  value="REGULAR" formControlName="tb_policy"  (click)="pendrePolicy($event)">
                      <label class="form-check-label" style="cursor: pointer;" for="hautEnBas">De haut en bas (Maximum 1 000 agents)<br/> Envoyer les appels dans la file d’attente des agents dans l’ordre, en commençant chaque fois par le haut.
                       
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" style="cursor: pointer;" type="radio" id="longtemp"  value="UNIFORM" formControlName="tb_policy"  (click)="pendrePolicy($event)">
                      <label class="form-check-label" style="cursor: pointer;" for="longtemp">La plus longue période d’inactivité (maximum 1 000 agents)
                    <br/>Envoyer les appels à l’agent qui est resté le plus longtemps inactif. S’il ne répond pas, passez à l’agent suivant qui a été inactif le plus longtemps, et ainsi de suite jusqu’à ce qu’il réponde à l’appel.
                    </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" style="cursor: pointer;" type="radio" id="pondere"  value="WEIGHTED" formControlName="tb_policy"  (click)="pendrePolicy($event)">
                      <label class="form-check-label" style="cursor: pointer;" for="pondere">Pondéré (Maximum 100 agents)<br/>Envoyer les appels vers les agents inactifs en fonction des pourcentages que vous attribuez à chaque membre du groupe de distribution des appels. Le pourcentage total des appels distribués doit être égal à 100 %.
                  
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" style="cursor: pointer;" type="radio" id="simultane"  value="SIMULTANEOUS" formControlName="tb_policy"  (click)="pendrePolicy($event)">
                      <label class="form-check-label" style="cursor: pointer;" for="simultane">Simultané (50 agents maximum)
                        <br/> Envoyer les appels à tous les agents de la file d’attente en même temps.
                        
                      </label>
                    </div>
                  </div>
                </div>
            
            </div>
            <div class="col-md-12" style="margin: 15px 0 15px 0; padding: 0; ">
                <!-- <div id="accordionEmplacement" class="accordion">
                  <div class="card">
                    <div class="card-header">
                      <span class="Title">
                        <i class="glyphicon glyphicon-hdd"></i>
                        Sélectionner les agents
                      </span>
                    </div>
                    <div id="collapseEmplacement" class="collapse show" data-parent="#accordionEmplacement">
                      <div class="card-body"> -->
                      
                        <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                          <div class="col-lg-12">
                            <span class="input-group-addon">
                              Sélectionnez les utilisateurs à ajouter à la file d’attente<br/>
                              Vous avez sélectionné le routage d’appel circulaire.    <br/>
                              <!-- Recherchez et ajoutez des utilisateurs par nom ou numéro de téléphone.     -->
                            </span>
                            <div class="form-line">
                              <ng-select formControlName="tb_agents" [multiple]="true" (change)="selectedUser($event)">
                                <ng-option *ngFor="let numuser of NumberAndUsers"
                                  [value]="numuser['owner']['id']">
                                  {{numuser['owner']['firstName']}}  {{numuser['owner']['lastName']}} ({{numuser['phoneNumber']}} 
                                  <span *ngIf="numuser['extension'] != null">, Ext {{numuser['extension']}}</span>)
                  
                                </ng-option>
                            
                              </ng-select>
                          
                            </div>
                          </div>
                         
                      
                      </div>
                      
                      <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; " *ngIf="tableUsersSelected">
                        <div class="col-lg-12">
                          <span class="input-group-addon">
                          
                          </span>
                          <table class="table table-striped table-bordered table-hover" cellspacing="0" rules="all" >
                            <tbody formArrayName="formCoefAndNiv">
                              <tr style="color:#5A5A5A;background-color:#E6E6E6;font-size:10px;font-weight:bold;height:30px;">
                              
                                <th style="text-align: center;">Nom</th>
                                 <th style="text-align: center;">Numéro de téléphone</th>
                                 <th style="text-align: center;">Extension</th>
                                 <th style="text-align: center;" *ngIf="showCoefficient">Coefficient</th>
                                <th style="text-align: center;"></th>
                              </tr>
                              <ng-container  *ngFor="let coefNivForm of formCoefAndNiv.controls;let i=index">
                                <tr style="font-size:10px;height:30px;text-align: center;" [formGroup]="coefNivForm">                                    
                                    <td> {{userSelected[i]['owner']['firstName']}}  {{userSelected[i]['owner']['lastName']}}</td>
                                    <td>{{userSelected[i]['phoneNumber']}}</td>
                                    <td>{{userSelected[i]['extension']}}</td>
                                    <td *ngIf="showCoefficient" style="display: flex;">
                                     
                                     <input type="number" max="100" min="0" maxlength="3" class="form-control" formControlName="tb_weight"> 
                                     <div>%</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-danger" style="margin-left: 10px; font-size: 12px; cursor: pointer;" (click)="DeleteUser(userSelected[i],i)"><i class="fa fa-trash-o"
                                          aria-hidden="true"></i>
                                        </span>
                                         
                                    </td>
                                </tr>
                                
                              </ng-container>
                           
                            </tbody>
                          </table>
                        </div>
                      </div>
              
                      <!-- </div>
                    </div>
                  </div>
                </div> -->
              </div> 
            
              </div>
            </div>
          </div>
        </div>
      </div> 
      <div class="col-md-12" style="margin: 15px 0 15px 0; padding: 0; ">
        <div id="accordionEmplacement" class="accordion">
          <div class="card">
            <div class="card-header">
              <span class="Title">
                <i class="glyphicon glyphicon-hdd"></i>
                Options de routage des appels

              </span>
            </div>
            <div id="collapseEmplacement" class="collapse show" data-parent="#accordionEmplacement">
              <div class="card-body">
              
                <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
                    <div class="col-lg-12">
                      <span class="input-group-addon">
                      </span>
                      <div class="form-check form-switch">
                        <input style="cursor: pointer;" class="form-check-input" type="checkbox" formControlName="tb_enableHuntGroupRingAdvance" id="checkPhone" (change)="affichehuntGroupRingAdvance($event)">
                        <label class="form-check-label" for="checkPhone">Continuez après avoir configuré le nombre de sonneries</label>
                      </div>
                    </div>
                
                </div>
                <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; " *ngIf="showhuntGroupRingAdvance">
                    <div class="col-lg-4">
                      <span class="input-group-addon">
                      </span>
                      <div class="row form-line">
                        
                            <input [ngClass]="{'is-invalid': submitted && f['tb_huntGroupRingAdvance'].errors }" class="form-control" type="number" formControlName="tb_huntGroupRingAdvance">
                            <span class="md-margin__left--s">Sonneries</span>
                       
                  
                        <div *ngIf="submitted && f['tb_huntGroupRingAdvance'].errors" class="invalid-feedback">
                            <div *ngIf="f['tb_huntGroupRingAdvance'].errors['required']">
                              Il faut saisir le nombre de sonneries.
                            </div>
                            <div *ngIf="f['tb_huntGroupRingAdvance'].errors['min']">
                                le nombre doit etre supérieure ou egale à 1.
                              </div>
                              <div *ngIf="f['tb_huntGroupRingAdvance'].errors['max']">
                                le nombre doit etre inférieure ou egale à 20.
                              </div>
                          </div>
                      </div>
                    </div>
                
                </div>
             
          <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
            <div class="col-lg-12">
              <span class="input-group-addon">
              
              </span>
            
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="advanceWhenBusy" formControlName="tb_advanceWhenBusy">
                <label class="form-check-label" for="advanceWhenBusy">Continuer lorsque la ligne est occupée
                    <br/>Lorsqu’il est activé, le groupe de recherche n’appelle pas les agents lorsqu’ils sont en ligne. Les appels entrants sont transmis à l’agent suivant. Si un agent du groupe de recherche a activé l’appel en attente et que l’appel lui est transmis, 
                    l’appel sera mis en attente jusqu’à ce que l’agent du groupe de recherche ne soit plus occupé.
                </label>
              </div>
            </div>
        
        </div>
        <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
            <div class="col-lg-12">
              <span class="input-group-addon">
              
              </span>
            
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="forwardCallAfterSetNumberOfRings" formControlName="tb_forwardCallAfterSetNumberOfRings" (change)="afficheforwardCallAfterSetNumberOfRings($event)">
                <label class="form-check-label" for="forwardCallAfterSetNumberOfRings">Renvoyer après un nombre de sonneries configuré
                    <br/>Si cette option est activée, les appels sans réponse après un nombre défini de sonneries sont renvoyés vers un numéro que vous définissez.
                </label>
              </div>
            </div>
        
        </div>
        <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; " *ngIf="showforwardCallAfterSetNumberOfRings">
            <div class="col-lg-4">
              <span class="input-group-addon">
              </span>
              <div class="form-check form-switch" style="display: flex;">
                <input [ngClass]="{'is-invalid': submitted && f['tb_numberOfRings'].errors }"  class="form-control" type="number" formControlName="tb_numberOfRings">
                <label class="form-check-label" for="checkPhone">Sonneries</label>
                <div *ngIf="submitted && f['tb_numberOfRings'].errors" class="invalid-feedback">
                    <div *ngIf="f['tb_numberOfRings'].errors['required']">
                      Il faut saisir le nombre de sonneries.
                    </div>
                    <div *ngIf="f['tb_huntGroupRingAdvance'].errors['min']">
                        le nombre doit etre supérieure ou egale à 1.
                      </div>
                      <div *ngIf="f['tb_huntGroupRingAdvance'].errors['max']">
                        le nombre doit etre inférieure ou egale à 99.
                      </div>
                  </div>
              </div>
            </div>
        
        </div>
        <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; " *ngIf="showforwardCallAfterSetNumberOfRings">
            <div class="col-md-5" style="padding-bottom:0;">
                <div class="input-group-tous">
                  <span class="input-group-addon">
                      <!-- Numéro de téléphone -->
                  </span>
                  <div class="form-line">
                      <ng-select 
                      formControlName="tb_numberToForwardTo" [searchFn]="startsWithSearchFn" [required]="showforwardCallAfterSetNumberOfRings">
                      <!-- <ng-option value="">Aucun</ng-option> -->
                      <ng-option *ngFor="let num of numberPhoneTransfert"
                        [value]="num['phoneNumber'] != null ? num['phoneNumber'] : num['extension']">{{num['owner']['firstName']}} {{num['owner']['lastName']}} ({{num['phoneNumber']}}<span *ngIf="num['phoneNumber'] != null">,</span> Ext {{num['extension']}})
                      </ng-option>
                    </ng-select> 
                    <div *ngIf="submitted && f['tb_numberToForwardTo'].errors" class="invalid-feedback">
                        <div *ngIf="f['tb_numberToForwardTo'].errors['required']">
                         Obligatoire
                        </div>
                      </div>
                  </div>
                </div>
              </div>
              <div class="col-md-5" style="padding-bottom:0;">
                <div class="input-group-tous">
                  <span class="input-group-addon">
                     
                  </span>
                  <div class="form-line">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input"  style="cursor: pointer;" type="checkbox" id="sendVoice" formControlName="tb_sendToVoicemail">
                      <label class="form-check-label" style="cursor: pointer;" for="sendVoice">Envoyer vers la messagerie vocale</label>
                    </div>
                  </div>
                </div>
              </div>
            
            
       
      </div>
      <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; ">
        <div class="col-lg-12">
          <span class="input-group-addon">
          
          </span>
        
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="divertCallWhenUnreachable" formControlName="tb_divertCallWhenUnreachable" (change)="afficheDestinationCallNoAnswered($event)">
            <label class="form-check-label" for="divertCallWhenUnreachable">Renvoyer les appels lorsque tous les agents sont injoignables
                <br/>Si cette option est activée, alors les appels sans réponse sont renvoyés vers un numéro que vous définissez.
                 Ceci s’applique aux appels sans réponse en raison d’une panne de courant ou parce que tous les membres
                 du groupe de distribution des appels sont occupés et que l’option Continuer lorsque la ligne est occupée est activée.
            </label>
          </div>
        </div>
        <div class="row Info" style="width: 100%; margin: 15px 0 15px 0; padding: 0; " *ngIf="showDestinationCallNoAnswered">
            <div class="col-lg-3">
              <span class="input-group-addon">
               
        
              </span>
              <div class="form-line">
               
                    <input type="text" [ngClass]="{'is-invalid': submitted && f['tb_numberToDivertTo'].errors }" placeholder="Numéro de téléphone" class="form-control" formControlName="tb_numberToDivertTo">
                    <div *ngIf="submitted && f['tb_numberToDivertTo'].errors" class="invalid-feedback">
                        <div *ngIf="f['tb_numberToDivertTo'].errors['required']">
                         Obligatoire
                        </div>
                      </div>
              
                
                
              </div>
            </div>
         
        
        </div>
    
    </div>
              </div>
            </div>
          </div>
        </div>
      </div> 
    
      <div class="col-md-12" style="text-align: end;">
        <div class="row">
          <div class="col-md-12">
            <button type="reset" style="margin-right: 15px;" class="btn btn-danger btn-xl" (click)="close()">Annuler</button>
            <button type="submit" style="margin-right: 15px;" class="btn btn-primary btn-xl">Modifier</button>
          </div>
        </div>
    </div>
    </form>
  </div>


